#!/usr/bin/env bash
set -eo pipefail

indent() {
  sed -u 's/^/       /'
}

GIFSICLE_VERSION="1.87"

echo "-----> Installing gifsicle $GIFSICLE_VERSION"

BUILD_DIR="$1"
VENDOR_PATH="$BUILD_DIR/vendor"

PROFILE_PATH="$BUILD_DIR/.profile.d"
INSTALL_PATH="$VENDOR_PATH/gifsicle"

DOWNLOAD_URL="https://github.com/kohler/gifsicle/archive/v$GIFSICLE_VERSION.tar.gz"

echo "DOWNLOAD_URL = " $DOWNLOAD_URL | indent

mkdir -p "$INSTALL_PATH"
# cd "$INSTALL_PATH"

curl -L --silent $DOWNLOAD_URL | tar xz

cd "gifsicle-$GIFSICLE_VERSION"

./bootstrap.sh
autoconf -i

./configure --disable-gifview --prefix="$INSTALL_PATH"
make
make install

echo 'export PATH="$PATH:$INSTALL_PATH"' >> "$PROFILE_PATH/gifsicle.sh"
